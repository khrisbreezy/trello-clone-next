{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/macbookpro/Desktop/Projects/React-Projects/trello-clone/pages/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useRef } from 'react';\nimport Board, { createTranslate } from 'react-trello';\nimport Router from 'next/router';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { CSVLink } from 'react-csv';\nimport { NotificationManager } from 'react-notifications';\nimport Cookies from 'js-cookie';\nimport { savePhaseData } from '../store/actions/phaseStore';\nimport { logout } from '../store/actions/auth';\nimport axiosInstance from '../config/axios';\nimport SingleActionCard from \"../components/SingleActionCard\";\n\nconst Home = () => {\n  const dispatch = useDispatch();\n  const btnRef = useRef();\n  const thePhaseData = useSelector(state => state.phaseData.phases);\n  const loggedIn = useSelector(state => state.auth.loggedIn);\n  let user = Cookies.get('user') || null;\n  user = typeof user === 'object' ? user : JSON.parse(user);\n  const token = Cookies.get('token');\n  const {\n    0: mapName,\n    1: setMapName\n  } = useState('Map Name');\n  const {\n    0: phaseData,\n    1: setPhaseData\n  } = useState(thePhaseData);\n  const {\n    0: csvData,\n    1: setCsvData\n  } = useState([]);\n  const {\n    0: currentCard,\n    1: setCurrentCard\n  } = useState(null);\n  const {\n    0: currentPhase,\n    1: setCurrentPhase\n  } = useState([]);\n  const {\n    0: phaseIndex,\n    1: setPhaseIndex\n  } = useState(null);\n  console.log({\n    phaseData\n  });\n  const TEXTS = {\n    \"Add another lane\": \"+ Add Phase\",\n    \"Click to add card\": \"Add actions\",\n    \"Delete lane\": \"Delete phase\",\n    \"Lane actions\": \"Phase actions\",\n    \"button\": {\n      \"Add lane\": \"Add Phase\",\n      \"Add card\": \"Add Action\",\n      \"Cancel\": \"Cancel\"\n    },\n    \"placeholder\": {\n      \"title\": \"action\",\n      \"description\": \"responsible\",\n      \"label\": \"output\"\n    }\n  };\n\n  const mapNameHandler = e => {\n    setMapName(e.target.value);\n  };\n\n  const headers = [{\n    label: 'Phase',\n    key: 'phase'\n  }, {\n    label: 'Action',\n    key: 'action'\n  }, {\n    label: 'Responsible',\n    key: 'responsible'\n  }];\n  const csvReport = {\n    filename: mapName.split(' ').join('-') + '.csv',\n    headers: headers,\n    data: csvData\n  };\n  const data = {\n    lanes: phaseData\n  };\n\n  const dataChange = data => {\n    setPhaseData(data.lanes);\n    dispatch(savePhaseData([]));\n  };\n\n  const cardClickHandler = (cardId, metadata, laneId) => {\n    const currentPhase = phaseData.filter(phase => phase.id === laneId);\n    const currentCard = currentPhase[0].cards.find(card => card.id === cardId);\n    const currentPhaseIndex = phaseData.findIndex(phase => phase.id === laneId); // const currentCardIndex = currentPhase[0].cards.findIndex(card => card.id === cardId);\n\n    setCurrentCard(currentCard);\n    setCurrentPhase(currentPhase);\n    setPhaseIndex(currentPhaseIndex);\n    $('#actionModal').modal('show'); // console.log({currentCard, metadata, currentPhase, currentPhaseIndex, currentCardIndex});\n  };\n\n  const gotoProcessBginfoHandler = () => {\n    dispatch(savePhaseData(phaseData));\n    Router.push('/process-background-information');\n  };\n\n  const sendDataToDatase = async () => {\n    let phase = [];\n    data.lanes.map(lane => {\n      phase.push({\n        'title': lane.title,\n        'card': lane.cards.map(card => ({\n          'action': card.title,\n          'responsibility': card.description\n        }))\n      });\n      console.log({\n        phase\n      });\n    });\n\n    try {\n      const {\n        data\n      } = await axiosInstance.post('processes', {\n        process_name: mapName,\n        user_id: user.id,\n        phase: phase\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      console.log({\n        data\n      });\n      let dataToExport = [];\n      phaseData.forEach(phase => {\n        phase.cards.forEach(card => {\n          dataToExport.push({\n            'phase': phase.title,\n            'action': card.title,\n            'responsible': card.description\n          });\n        });\n      });\n      await setCsvData(dataToExport);\n      btnRef.current.link.click();\n      dispatch(savePhaseData([]));\n    } catch (e) {\n      console.log(e);\n    }\n  };\n\n  const exportDataHandler = async () => {\n    // if (!loggedIn) {\n    //     $('#authModal').modal('show');\n    //     return;\n    // }\n    let dataToExport = [];\n    phaseData.forEach(phase => {\n      phase.cards.forEach(card => {\n        dataToExport.push({\n          'phase': phase.title,\n          'action': card.title,\n          'responsible': card.description\n        });\n      });\n    });\n    await setCsvData(dataToExport);\n    btnRef.current.link.click();\n    dispatch(savePhaseData([])); // await sendDataToDatase();\n  };\n\n  const loginHandler = () => {\n    $('#authModal').modal('show');\n  };\n\n  const loginOutHandler = () => {\n    dispatch(logout());\n    NotificationManager.success('Logout successfully', '', 5000);\n  };\n\n  const resetDataAfterUpdate = () => {\n    setCurrentCard(null);\n    setCurrentPhase([]);\n    setPhaseIndex(null);\n  };\n\n  const storeEdittedDataToState = data => {\n    setPhaseData(data);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    className: \"page_manager\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container-fluid\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-12 text-center d-flex align-items-center justify-content-center\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            className: \"mapName_input mx-3\",\n            type: \"text\",\n            value: mapName,\n            onChange: mapNameHandler\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row\",\n        children: /*#__PURE__*/_jsxDEV(Board, {\n          data: data,\n          editLaneTitle: true,\n          editable: true,\n          canAddLanes: true,\n          onDataChange: dataChange,\n          t: createTranslate(TEXTS),\n          onCardClick: cardClickHandler,\n          laneDraggable: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 20\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"row text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6 mb-4\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: gotoProcessBginfoHandler,\n            className: \"btn\",\n            children: \"Add process background\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"col-md-6 mb-4\",\n          children: [/*#__PURE__*/_jsxDEV(CSVLink, _objectSpread(_objectSpread({\n            className: \"d-none\",\n            ref: btnRef\n          }, csvReport), {}, {\n            children: \"Export\"\n          }), void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: exportDataHandler,\n            className: \"btn\",\n            children: \"Export to data frame\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(SingleActionCard, {\n      currentCard: currentCard,\n      currentPhase: currentPhase,\n      phaseData: phaseData,\n      phaseIndex: phaseIndex,\n      resetDataAfterUpdate: resetDataAfterUpdate,\n      storeEdittedDataToState: storeEdittedDataToState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 185,\n    columnNumber: 9\n  }, this);\n};\n\nexport default Home;","map":{"version":3,"sources":["/Users/macbookpro/Desktop/Projects/React-Projects/trello-clone/pages/index.js"],"names":["React","useState","useRef","Board","createTranslate","Router","useSelector","useDispatch","CSVLink","NotificationManager","Cookies","savePhaseData","logout","axiosInstance","SingleActionCard","Home","dispatch","btnRef","thePhaseData","state","phaseData","phases","loggedIn","auth","user","get","JSON","parse","token","mapName","setMapName","setPhaseData","csvData","setCsvData","currentCard","setCurrentCard","currentPhase","setCurrentPhase","phaseIndex","setPhaseIndex","console","log","TEXTS","mapNameHandler","e","target","value","headers","label","key","csvReport","filename","split","join","data","lanes","dataChange","cardClickHandler","cardId","metadata","laneId","filter","phase","id","cards","find","card","currentPhaseIndex","findIndex","$","modal","gotoProcessBginfoHandler","push","sendDataToDatase","map","lane","title","description","post","process_name","user_id","Authorization","dataToExport","forEach","current","link","click","exportDataHandler","loginHandler","loginOutHandler","success","resetDataAfterUpdate","storeEdittedDataToState"],"mappings":"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","sourcesContent":["\nimport React, { useState, useRef } from 'react';\nimport Board, { createTranslate } from 'react-trello';\nimport Router from 'next/router';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { CSVLink } from 'react-csv';\nimport {NotificationManager} from 'react-notifications';\nimport Cookies from 'js-cookie';\n\nimport { savePhaseData } from '../store/actions/phaseStore';\nimport { logout } from '../store/actions/auth';\nimport axiosInstance from '../config/axios';\nimport SingleActionCard from \"../components/SingleActionCard\";\n\n\nconst Home = () => {\n\n    const dispatch = useDispatch();\n    const btnRef = useRef();\n\n    const thePhaseData = useSelector(state => state.phaseData.phases);\n    const loggedIn = useSelector(state => state.auth.loggedIn);\n    let user = Cookies.get('user') || null;\n    user = typeof user === 'object' ? user : JSON.parse(user);\n    const token = Cookies.get('token');\n\n    const [ mapName, setMapName ] = useState('Map Name');\n    const [phaseData, setPhaseData] = useState(thePhaseData);\n    const [csvData, setCsvData] = useState([]);\n    const [currentCard, setCurrentCard] = useState(null);\n    const [currentPhase, setCurrentPhase] = useState([]);\n    const [phaseIndex, setPhaseIndex] = useState(null);\n\n    console.log({phaseData});\n\n    const TEXTS = {\n        \"Add another lane\": \"+ Add Phase\",  \n        \"Click to add card\": \"Add actions\",\n        \"Delete lane\": \"Delete phase\",\n        \"Lane actions\": \"Phase actions\",\n        \"button\": {\n          \"Add lane\": \"Add Phase\",\n          \"Add card\": \"Add Action\",\n          \"Cancel\": \"Cancel\"\n        },\n        \"placeholder\": {\n          \"title\": \"action\",\n          \"description\": \"responsible\",\n          \"label\": \"output\"\n        }\n    };\n\n    const mapNameHandler = (e) => {\n        setMapName(e.target.value);\n    };\n\n    const headers = [\n        {label: 'Phase', key: 'phase'},\n        {label: 'Action', key: 'action'},\n        {label: 'Responsible', key: 'responsible'}\n    ];\n\n    const csvReport = {\n        filename: mapName.split(' ').join('-') + '.csv',\n        headers: headers,\n        data: csvData\n    };\n\n    const data = {\n        lanes: phaseData\n    };\n\n    const dataChange = (data) => {\n        setPhaseData(data.lanes);\n        dispatch(savePhaseData([]));\n    };\n\n    const cardClickHandler = (cardId, metadata, laneId) => {\n        const currentPhase = phaseData.filter((phase) => phase.id === laneId);\n        const currentCard = currentPhase[0].cards.find((card) => card.id === cardId);\n        const currentPhaseIndex = phaseData.findIndex(phase => phase.id === laneId);\n        // const currentCardIndex = currentPhase[0].cards.findIndex(card => card.id === cardId);\n\n        setCurrentCard(currentCard);\n        setCurrentPhase(currentPhase);\n        setPhaseIndex(currentPhaseIndex);\n\n        $('#actionModal').modal('show');\n\n        // console.log({currentCard, metadata, currentPhase, currentPhaseIndex, currentCardIndex});\n    }\n\n    const gotoProcessBginfoHandler = () => {\n        \n        dispatch(savePhaseData(phaseData));\n        Router.push('/process-background-information');\n    };\n\n    const sendDataToDatase = async () => {\n        let phase = [];\n        data.lanes.map((lane => { \n            phase.push({\n                'title': lane.title,\n                'card': lane.cards.map((card) => ({\n                    'action': card.title,\n                    'responsibility': card.description\n                }))\n            });\n            \n            console.log({phase});\n        }))\n        try {\n            const { data } = await axiosInstance.post('processes', {\n                process_name: mapName, \n                user_id: user.id,\n                phase: phase\n            }, {\n                headers: {\n                    Authorization: `Bearer ${token}`\n                }\n            });\n            console.log({data});\n            let dataToExport = [];\n            phaseData.forEach(phase => {\n                phase.cards.forEach(card => {\n                    dataToExport.push({\n                        'phase': phase.title,\n                        'action': card.title,\n                        'responsible': card.description\n                    });\n                })\n            });\n\n            await setCsvData(dataToExport);\n            btnRef.current.link.click();\n            dispatch(savePhaseData([]));\n        } catch(e) {\n            console.log(e);\n        }\n    };\n\n    const exportDataHandler = async () => {\n        // if (!loggedIn) {\n        //     $('#authModal').modal('show');\n        //     return;\n        // }\n        let dataToExport = [];\n        phaseData.forEach(phase => {\n            phase.cards.forEach(card => {\n                dataToExport.push({\n                    'phase': phase.title,\n                    'action': card.title,\n                    'responsible': card.description\n                });\n            })\n        });\n\n        await setCsvData(dataToExport);\n        btnRef.current.link.click();\n        dispatch(savePhaseData([]));\n        // await sendDataToDatase();\n    };\n\n    const loginHandler = () => {\n        $('#authModal').modal('show');\n    };\n\n    const loginOutHandler = () => {\n        dispatch(logout());\n        NotificationManager.success('Logout successfully', '', 5000);\n    };\n\n    const resetDataAfterUpdate = () => {\n        setCurrentCard(null);\n        setCurrentPhase([]);\n        setPhaseIndex(null);\n    };\n\n    const storeEdittedDataToState = (data) => {\n        setPhaseData(data);\n    };\n  \n\n    return (\n        <section className='page_manager'>\n            <div className=\"container-fluid\">  \n                <div className=\"row\">\n                    <div className=\"col-12 text-center d-flex align-items-center justify-content-center\">\n                        <input className='mapName_input mx-3' type=\"text\" value={mapName} onChange={mapNameHandler} />\n                        {/* {!loggedIn ? \n                        <button onClick={loginHandler} className='btn btn-login'>Login</button>\n                        :\n                        <button onClick={loginOutHandler} className='btn btn-login'>Logout</button>} */}\n                    </div>\n                </div>\n\n                <div className=\"row\">\n                   <Board data={data}\n                    editLaneTitle\n                    editable\n                    canAddLanes={true}\n                    onDataChange={dataChange}\n                    t={createTranslate(TEXTS)}\n                    onCardClick={cardClickHandler}\n                    laneDraggable\n                    /> \n                </div>\n\n                <div className=\"row text-center\">\n                    <div className=\"col-md-6 mb-4\">\n                        <button onClick={gotoProcessBginfoHandler} className=\"btn\">Add process background</button>\n                    </div>\n                    <div className=\"col-md-6 mb-4\">\n                        <CSVLink className='d-none' ref={btnRef} {...csvReport}>Export</CSVLink>\n                        <button onClick={exportDataHandler} className=\"btn\">Export to data frame</button>\n                    </div>         \n                </div>\n            </div>\n            <SingleActionCard \n            currentCard={currentCard} \n            currentPhase={currentPhase}\n            phaseData={phaseData}\n            phaseIndex={phaseIndex}\n            resetDataAfterUpdate={resetDataAfterUpdate}\n            storeEdittedDataToState={storeEdittedDataToState}\n           />\n        </section>\n    )\n  \n};\n\nexport default Home;\n\n"]},"metadata":{},"sourceType":"module"}